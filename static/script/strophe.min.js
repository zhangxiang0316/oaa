"function"===typeof define&&define.amd&&(define.tmpAmd=define.amd,define.amd=void 0);
(function(b){var a=function(){return{encode:function(a){var b="",c,k,d,e,x,f,g,h=0;do c=a.charCodeAt(h++),k=a.charCodeAt(h++),d=a.charCodeAt(h++),e=c>>2,x=(c&3)<<4|k>>4,f=(k&15)<<2|d>>6,g=d&63,isNaN(k)?(x=(c&3)<<4,f=g=64):isNaN(d)&&(g=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(x)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);
while(h<a.length);return b},decode:function(a){var b="",c,k,d,e,x,f=0,a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),c=c<<2|k>>4,k=(k&15)<<
4|e>>2,d=(e&3)<<6|x,b+=String.fromCharCode(c),64!=e&&(b+=String.fromCharCode(k)),64!=x&&(b+=String.fromCharCode(d));while(f<a.length);return b}}};"function"===typeof define&&define.amd?define("strophe-base64",function(){return a()}):this.Base64=a();var c=function(){function a(b,f){b[f>>5]|=128<<24-f%32;b[(f+64>>9<<4)+15]=f;var g=Array(80),h=1732584193,i=-271733879,j=-1732584194,k=271733878,d=-1009589776,t,e,r,n,y,l,v,p;for(t=0;t<b.length;t+=16){n=h;y=i;l=j;v=k;p=d;for(e=0;80>e;e++){g[e]=16>e?b[t+
e]:(g[e-3]^g[e-8]^g[e-14]^g[e-16])<<1|(g[e-3]^g[e-8]^g[e-14]^g[e-16])>>>31;r=h<<5|h>>>27;var s;s=20>e?i&j|~i&k:40>e?i^j^k:60>e?i&j|i&k|j&k:i^j^k;r=c(c(r,s),c(c(d,g[e]),20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514));d=k;k=j;j=i<<30|i>>>2;i=h;h=r}h=c(h,n);i=c(i,y);j=c(j,l);k=c(k,v);d=c(d,p)}return[h,i,j,k,d]}function b(c,f){var g=k(c);16<g.length&&(g=a(g,8*c.length));for(var h=Array(16),i=Array(16),j=0;16>j;j++)h[j]=g[j]^909522486,i[j]=g[j]^1549556828;g=a(h.concat(k(f)),512+8*f.length);
return a(i.concat(g),672)}function c(b,a){var g=(b&65535)+(a&65535);return(b>>16)+(a>>16)+(g>>16)<<16|g&65535}function k(b){for(var a=[],g=0;g<8*b.length;g+=8)a[g>>5]|=(b.charCodeAt(g/8)&255)<<24-g%32;return a}function d(a){for(var b="",g=0;g<32*a.length;g+=8)b+=String.fromCharCode(a[g>>5]>>>24-g%32&255);return b}function e(b){for(var a="",g,h,i=0;i<4*b.length;i+=3){g=(b[i>>2]>>8*(3-i%4)&255)<<16|(b[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|b[i+2>>2]>>8*(3-(i+2)%4)&255;for(h=0;4>h;h++)a=8*i+6*h>32*b.length?
a+"=":a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>6*(3-h)&63)}return a}return{b64_hmac_sha1:function(a,f){return e(b(a,f))},b64_sha1:function(b){return e(a(k(b),8*b.length))},binb2str:d,core_hmac_sha1:b,str_hmac_sha1:function(a,f){return d(b(a,f))},str_sha1:function(b){return d(a(k(b),8*b.length))}}};"function"===typeof define&&define.amd?define("strophe-sha1",function(){return c()}):this.SHA1=c();var d=function(){var b=function(b,g){var h=(b&65535)+(g&65535);return(b>>
16)+(g>>16)+(h>>16)<<16|h&65535},a=function(b){for(var g=[],h=0;h<8*b.length;h+=8)g[h>>5]|=(b.charCodeAt(h/8)&255)<<h%32;return g},c=function(a,g,h,c,j,q){a=b(b(g,a),b(c,q));return b(a<<j|a>>>32-j,h)},k=function(b,g,h,a,j,d,k){return c(g&h|~g&a,b,g,j,d,k)},d=function(b,g,a,i,j,d,k){return c(g&i|a&~i,b,g,j,d,k)},e=function(b,g,a,i,j,d,k){return c(a^(g|~i),b,g,j,d,k)},l=function(a,g){a[g>>5]|=128<<g%32;a[(g+64>>>9<<4)+14]=g;for(var h=1732584193,i=-271733879,j=-1732584194,m=271733878,z,A,l,v,n=0;n<a.length;n+=
16)z=h,A=i,l=j,v=m,h=k(h,i,j,m,a[n+0],7,-680876936),m=k(m,h,i,j,a[n+1],12,-389564586),j=k(j,m,h,i,a[n+2],17,606105819),i=k(i,j,m,h,a[n+3],22,-1044525330),h=k(h,i,j,m,a[n+4],7,-176418897),m=k(m,h,i,j,a[n+5],12,1200080426),j=k(j,m,h,i,a[n+6],17,-1473231341),i=k(i,j,m,h,a[n+7],22,-45705983),h=k(h,i,j,m,a[n+8],7,1770035416),m=k(m,h,i,j,a[n+9],12,-1958414417),j=k(j,m,h,i,a[n+10],17,-42063),i=k(i,j,m,h,a[n+11],22,-1990404162),h=k(h,i,j,m,a[n+12],7,1804603682),m=k(m,h,i,j,a[n+13],12,-40341101),j=k(j,m,h,
i,a[n+14],17,-1502002290),i=k(i,j,m,h,a[n+15],22,1236535329),h=d(h,i,j,m,a[n+1],5,-165796510),m=d(m,h,i,j,a[n+6],9,-1069501632),j=d(j,m,h,i,a[n+11],14,643717713),i=d(i,j,m,h,a[n+0],20,-373897302),h=d(h,i,j,m,a[n+5],5,-701558691),m=d(m,h,i,j,a[n+10],9,38016083),j=d(j,m,h,i,a[n+15],14,-660478335),i=d(i,j,m,h,a[n+4],20,-405537848),h=d(h,i,j,m,a[n+9],5,568446438),m=d(m,h,i,j,a[n+14],9,-1019803690),j=d(j,m,h,i,a[n+3],14,-187363961),i=d(i,j,m,h,a[n+8],20,1163531501),h=d(h,i,j,m,a[n+13],5,-1444681467),m=
d(m,h,i,j,a[n+2],9,-51403784),j=d(j,m,h,i,a[n+7],14,1735328473),i=d(i,j,m,h,a[n+12],20,-1926607734),h=c(i^j^m,h,i,a[n+5],4,-378558),m=c(h^i^j,m,h,a[n+8],11,-2022574463),j=c(m^h^i,j,m,a[n+11],16,1839030562),i=c(j^m^h,i,j,a[n+14],23,-35309556),h=c(i^j^m,h,i,a[n+1],4,-1530992060),m=c(h^i^j,m,h,a[n+4],11,1272893353),j=c(m^h^i,j,m,a[n+7],16,-155497632),i=c(j^m^h,i,j,a[n+10],23,-1094730640),h=c(i^j^m,h,i,a[n+13],4,681279174),m=c(h^i^j,m,h,a[n+0],11,-358537222),j=c(m^h^i,j,m,a[n+3],16,-722521979),i=c(j^
m^h,i,j,a[n+6],23,76029189),h=c(i^j^m,h,i,a[n+9],4,-640364487),m=c(h^i^j,m,h,a[n+12],11,-421815835),j=c(m^h^i,j,m,a[n+15],16,530742520),i=c(j^m^h,i,j,a[n+2],23,-995338651),h=e(h,i,j,m,a[n+0],6,-198630844),m=e(m,h,i,j,a[n+7],10,1126891415),j=e(j,m,h,i,a[n+14],15,-1416354905),i=e(i,j,m,h,a[n+5],21,-57434055),h=e(h,i,j,m,a[n+12],6,1700485571),m=e(m,h,i,j,a[n+3],10,-1894986606),j=e(j,m,h,i,a[n+10],15,-1051523),i=e(i,j,m,h,a[n+1],21,-2054922799),h=e(h,i,j,m,a[n+8],6,1873313359),m=e(m,h,i,j,a[n+15],10,
-30611744),j=e(j,m,h,i,a[n+6],15,-1560198380),i=e(i,j,m,h,a[n+13],21,1309151649),h=e(h,i,j,m,a[n+4],6,-145523070),m=e(m,h,i,j,a[n+11],10,-1120210379),j=e(j,m,h,i,a[n+2],15,718787259),i=e(i,j,m,h,a[n+9],21,-343485551),h=b(h,z),i=b(i,A),j=b(j,l),m=b(m,v);return[h,i,j,m]};return{hexdigest:function(b){for(var b=l(a(b),8*b.length),g="",h=0;h<4*b.length;h++)g+="0123456789abcdef".charAt(b[h>>2]>>8*(h%4)+4&15)+"0123456789abcdef".charAt(b[h>>2]>>8*(h%4)&15);return g},hash:function(b){for(var b=l(a(b),8*b.length),
g="",h=0;h<32*b.length;h+=8)g+=String.fromCharCode(b[h>>5]>>>h%32&255);return g}}};"function"===typeof define&&define.amd?define("strophe-md5",function(){return d()}):this.MD5=d();var e=function(){return{utf16to8:function(a){var b,c,d="",e=a.length;for(b=0;b<e;b++)c=a.charCodeAt(b),0<=c&&127>=c?d+=a.charAt(b):(2047<c?(d+=String.fromCharCode(224|c>>12&15),d+=String.fromCharCode(128|c>>6&63)):d+=String.fromCharCode(192|c>>6&31),d+=String.fromCharCode(128|c>>0&63));return d},addCookies:function(a){var b,
c,d,e,l,p,f;for(b in a||{})f=p=l="",c=a[b],d="object"==typeof c,e=escape(unescape(d?c.value:c)),d&&(l=c.expires?";expires="+c.expires:"",p=c.domain?";domain="+c.domain:"",f=c.path?";path="+c.path:""),document.cookie=b+"="+e+l+p+f}}};"function"===typeof define&&define.amd?define("strophe-utils",function(){return e()}):this.stropheUtils=e();var l=function(){Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);
return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)})};"function"===typeof define&&define.amd?define("strophe-polyfill",[],function(){return l()}):l();var s=function(a,b,c,d){function e(g,a){return new f.Builder(g,a)}function l(g){return new f.Builder("iq",g)}function p(g){return new f.Builder("presence",g)}var f;f={VERSION:"1.2.12",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",
BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",
STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:"a blockquote br cite em img li ol p span strong ul body".split(" "),attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:"background-color color font-family font-size font-style font-weight margin-left margin-right text-align text-decoration".split(" "),
validTag:function(g){for(var a=0;a<f.XHTML.tags.length;a++)if(g==f.XHTML.tags[a])return!0;return!1},validAttribute:function(g,a){if("undefined"!==typeof f.XHTML.attributes[g]&&0<f.XHTML.attributes[g].length)for(var b=0;b<f.XHTML.attributes[g].length;b++)if(a==f.XHTML.attributes[g][b])return!0;return!1},validCSS:function(g){for(var a=0;a<f.XHTML.css.length;a++)if(g==f.XHTML.css[a])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,
ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,addNamespace:function(g,a){f.NS[g]=a},forEachChild:function(g,a,b){var c,d;for(c=0;c<g.childNodes.length;c++)d=g.childNodes[c],d.nodeType==f.ElementType.NORMAL&&(!a||this.isTagEqual(d,a))&&b(d)},isTagEqual:function(g,a){return g.tagName==a},_xmlGenerator:null,_makeGenerator:function(){var g;void 0===document.implementation.createDocument||
document.implementation.createDocument&&document.documentMode&&10>document.documentMode?(g=this._getIEXmlDom(),g.appendChild(g.createElement("strophe"))):g=document.implementation.createDocument("jabber:client","strophe",null);return g},xmlGenerator:function(){f._xmlGenerator||(f._xmlGenerator=f._makeGenerator());return f._xmlGenerator},_getIEXmlDom:function(){for(var g=null,a="Msxml2.DOMDocument.6.0 Msxml2.DOMDocument.5.0 Msxml2.DOMDocument.4.0 MSXML2.DOMDocument.3.0 MSXML2.DOMDocument MSXML.DOMDocument Microsoft.XMLDOM".split(" "),
b=0;b<a.length;b++)if(null===g)try{g=new ActiveXObject(a[b])}catch(c){g=null}else break;return g},xmlElement:function(g){if(!g)return null;var a=f.xmlGenerator().createElement(g),b,c,d;for(b=1;b<arguments.length;b++){var e=arguments[b];if(e)if("string"==typeof e||"number"==typeof e)a.appendChild(f.xmlTextNode(e));else if("object"==typeof e&&"function"==typeof e.sort)for(c=0;c<e.length;c++){var k=e[c];"object"==typeof k&&("function"==typeof k.sort&&void 0!==k[1]&&null!==k[1])&&a.setAttribute(k[0],
k[1])}else if("object"==typeof e)for(d in e)e.hasOwnProperty(d)&&void 0!==e[d]&&null!==e[d]&&a.setAttribute(d,e[d])}return a},xmlescape:function(g){g=g.replace(/\&/g,"&amp;");g=g.replace(/</g,"&lt;");g=g.replace(/>/g,"&gt;");g=g.replace(/'/g,"&apos;");return g=g.replace(/"/g,"&quot;")},xmlunescape:function(g){g=g.replace(/\&amp;/g,"&");g=g.replace(/&lt;/g,"<");g=g.replace(/&gt;/g,">");g=g.replace(/&apos;/g,"'");return g=g.replace(/&quot;/g,'"')},xmlTextNode:function(g){return f.xmlGenerator().createTextNode(g)},
xmlHtmlNode:function(g){var a;window.DOMParser?a=(new DOMParser).parseFromString(g,"text/xml"):(a=new ActiveXObject("Microsoft.XMLDOM"),a.async="false",a.loadXML(g));return a},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==f.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==f.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return f.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==f.ElementType.NORMAL){c=
f.xmlElement(a.tagName);for(b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName,a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.copyElement(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,k,q,t,r,n,l,p;if(a.nodeType==f.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),f.XHTML.validTag(e))try{c=f.xmlElement(e);for(b=0;b<f.XHTML.attributes[e].length;b++)if(k=
f.XHTML.attributes[e][b],q=a.getAttribute(k),!("undefined"==typeof q||null===q||""===q||!1===q||0===q))if("style"==k&&"object"==typeof q&&"undefined"!=typeof q.cssText&&(q=q.cssText),"style"==k){t=[];r=q.split(";");for(d=0;d<r.length;d++)n=r[d].split(":"),l=n[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),f.XHTML.validCSS(l)&&(p=n[1].replace(/^\s*/,"").replace(/\s*$/,""),t.push(l+": "+p));0<t.length&&(q=t.join("; "),c.setAttribute(k,q))}else c.setAttribute(k,q);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]))}catch(y){c=
f.xmlTextNode("")}else{c=f.xmlGenerator().createDocumentFragment();for(b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]))}else if(a.nodeType==f.ElementType.FRAGMENT){c=f.xmlGenerator().createDocumentFragment();for(b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return"string"!==typeof a?a:a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,
"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return"string"!==typeof a?a:a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return 0>a.indexOf("@")?null:
a.split("@")[0]},getDomainFromJid:function(a){a=f.getBareJidFromJid(a);if(0>a.indexOf("@"))return a;a=a.split("@");a.splice(0,1);return a.join("@")},getResourceFromJid:function(a){a=a.split("/");if(2>a.length)return null;a.splice(0,1);return a.join("/")},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},_handleError:function(a){"undefined"!==typeof a.stack&&f.fatal(a.stack);a.sourceURL?f.fatal("error: "+this.handler+" "+a.sourceURL+":"+a.line+" - "+a.name+": "+a.message):a.fileName?f.fatal("error: "+
this.handler+" "+a.fileName+":"+a.lineNumber+" - "+a.name+": "+a.message):f.fatal("error: "+a.message)},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"===typeof a.tree&&(a=a.tree());var c=a.nodeName,d,e;a.getAttribute("_realname")&&
(c=a.getAttribute("_realname"));b="<"+c;for(d=0;d<a.attributes.length;d++)"_realname"!=a.attributes[d].nodeName&&(b+=" "+a.attributes[d].nodeName+"='"+f.xmlescape(a.attributes[d].value)+"'");if(0<a.childNodes.length){b+=">";for(d=0;d<a.childNodes.length;d++)switch(e=a.childNodes[d],e.nodeType){case f.ElementType.NORMAL:b+=f.serialize(e);break;case f.ElementType.TEXT:b+=f.xmlescape(e.nodeValue);break;case f.ElementType.CDATA:b+="<![CDATA["+e.nodeValue+"]]\>"}b+="</"+c+">"}else b+="/>";return b},_requestId:0,
_connectionPlugins:{},addConnectionPlugin:function(a,b){f._connectionPlugins[a]=b},Builder:function(a,b){if("presence"==a||"message"==a||"iq"==a)b&&!b.xmlns?b.xmlns=f.NS.CLIENT:b||(b={xmlns:f.NS.CLIENT});this.node=this.nodeTree=f.xmlElement(a,b)}};f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},root:function(){this.node=this.nodeTree;return this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&
(void 0===a[b]?this.node.removeAttribute(b):this.node.setAttribute(b,a[b]));return this},c:function(a,b,c){a=f.xmlElement(a,b,c);this.node.appendChild(a);"string"!==typeof c&&"number"!==typeof c&&(this.node=a);return this},cnode:function(a){var b,c=f.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}a=b?c.importNode(a,!0):f.copyElement(a);this.node.appendChild(a);this.node=a;return this},t:function(a){a=f.xmlTextNode(a);this.node.appendChild(a);return this},h:function(a){var b=document.createElement("body");
b.innerHTML=a;for(a=f.createHtml(b);0<a.childNodes.length;)this.node.appendChild(a.childNodes[0]);return this}};f.Handler=function(a,b,c,d,e,k,q){this.handler=a;this.ns=b;this.name=c;this.type=d;this.id=e;this.options=q||{matchBareFromJid:!1,ignoreNamespaceFragment:!1};this.options.matchBare&&(f.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare);this.from=this.options.matchBareFromJid?k?
f.getBareJidFromJid(k):null:k;this.user=!0};f.Handler.prototype={getNamespace:function(a){(a=a.getAttribute("xmlns"))&&this.options.ignoreNamespaceFragment&&(a=a.split("#")[0]);return a},namespaceMatch:function(a){var b=!1;if(this.ns){var c=this;f.forEachChild(a,null,function(a){c.getNamespace(a)===c.ns&&(b=!0)});b=b||this.getNamespace(a)===this.ns}else return!0;return b},isMatch:function(a){var b=a.getAttribute("from");this.options.matchBareFromJid&&(b=f.getBareJidFromJid(b));var c=a.getAttribute("type");
return this.namespaceMatch(a)&&(!this.name||f.isTagEqual(a,this.name))&&(!this.type||(Array.isArray(this.type)?-1!=this.type.indexOf(c):c==this.type))&&(!this.id||a.getAttribute("id")==this.id)&&(!this.from||b==this.from)?!0:!1},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw f._handleError(c),c;}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};f.TimedHandler=function(a,b){this.period=a;this.handler=b;this.lastCalled=(new Date).getTime();
this.user=!0};f.TimedHandler.prototype={run:function(){this.lastCalled=(new Date).getTime();return this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};f.Connection=function(a,b){this.service=a;this.options=b||{};var c=this.options.protocol||"";this._proto=(this.useWebSocket=0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws"))?new f.Websocket(this):new f.Bosh(this);this.jid="";this.features=
this.domain=null;this._sasl_data={};this.do_bind=this.do_session=!1;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.protocolErrorHandlers={HTTP:{},websocket:{}};this._disconnectTimeout=this._idleTimeout=null;this.disconnecting=this.connected=this.authenticated=!1;this.do_authentication=!0;this.restored=this.paused=!1;this._data=[];this._uniqueId=0;this._sasl_challenge_handler=this._sasl_failure_handler=this._sasl_success_handler=
null;this.maxRetries=5;this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100);d.addCookies(this.options.cookies);this.registerSASLMechanisms(this.options.mechanisms);for(var e in f._connectionPlugins)f._connectionPlugins.hasOwnProperty(e)&&(c=function(){},c.prototype=f._connectionPlugins[e],this[e]=new c,this[e].init(this))};f.Connection.prototype={reset:function(){this._proto._reset();this.do_bind=this.do_session=!1;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=
[];this.addTimeds=[];this.addHandlers=[];this.restored=this.disconnecting=this.connected=this.authenticated=!1;this._data=[];this._requests=[];this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});return"string"==typeof a||"number"==typeof a?b+":"+a:b+""},addProtocolErrorHandler:function(a,b,c){this.protocolErrorHandlers[a][b]=
c},connect:function(a,b,c,d,e,k,q){this.jid=a;this.authzid=f.getBareJidFromJid(this.jid);this.authcid=q||f.getNodeFromJid(this.jid);this.pass=b;this.servtype="xmpp";this.connect_callback=c;this.restored=this.authenticated=this.connected=this.disconnecting=!1;this.domain=f.getDomainFromJid(this.jid);this._changeConnectStatus(f.Status.CONNECTING,null);this._proto._connect(d,e,k)},attach:function(a,b,c,d,e,k,q){if(this._proto instanceof f.Bosh)this._proto._attach(a,b,c,d,e,k,q);else throw{name:"StropheSessionError",
message:'The "attach" method can only be used with a BOSH connection.'};},restore:function(a,b,c,d,f){if(this._sessionCachingSupported())this._proto._restore(a,b,c,d,f);else throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};},_sessionCachingSupported:function(){if(this._proto instanceof f.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(a){return!1}return!0}return!1},
xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},nextValidRid:function(){},send:function(a){if(null!==a){if("function"===typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else"function"===typeof a.tree?this._queueData(a.tree()):this._queueData(a);this._proto._send()}},sendRequestAcknowledgement:function(a){if(null!==a)if("function"===typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else"function"===typeof a.tree?this._queueData(a.tree()):
this._queueData(a)},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendPresence:function(a,b,c,d){var f=null,e=this;"function"===typeof a.tree&&(a=a.tree());var k=a.getAttribute("id");k||(k=this.getUniqueId("sendPresence"),a.setAttribute("id",k));if("function"===typeof b||"function"===typeof c){var q=this.addHandler(function(a){f&&e.deleteTimedHandler(f);"error"==a.getAttribute("type")?c&&c(a):b&&b(a)},null,"presence",null,k);d&&(f=this.addTimedHandler(d,function(){e.deleteHandler(q);
c&&c(null);return!1}))}this.send(a);return k},sendIQ:function(a,b,c,d){var f=null,e=this;"function"===typeof a.tree&&(a=a.tree());var k=a.getAttribute("id");k||(k=this.getUniqueId("sendIQ"),a.setAttribute("id",k));if("function"===typeof b||"function"===typeof c){var q=this.addHandler(function(a){f&&e.deleteTimedHandler(f);var g=a.getAttribute("type");if("result"==g)b&&b(a);else if("error"==g)c&&c(a);else throw{name:"StropheError",message:"Got bad IQ type of "+g};},null,"iq",["error","result"],k);
d&&(f=this.addTimedHandler(d,function(){e.deleteHandler(q);c&&c(null);return!1}))}this.send(a);return k},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart");this._proto._sendRestart();this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);this.addTimeds.push(c);return c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},
addHandler:function(a,b,c,d,e,k,q){a=new f.Handler(a,b,c,d,e,k,q);this.addHandlers.push(a);return a},deleteHandler:function(a){this.removeHandlers.push(a);a=this.addHandlers.indexOf(a);0<=a&&this.addHandlers.splice(a,1)},registerSASLMechanisms:function(a){this.mechanisms={};a=a||[f.SASLAnonymous,f.SASLExternal,f.SASLMD5,f.SASLOAuthBearer,f.SASLPlain,f.SASLSHA1];a.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(a){this.mechanisms[a.prototype.name]=a},disconnect:function(a){this._changeConnectStatus(f.Status.DISCONNECTING,
a);f.info("Disconnect was called because: "+a);this.connected?(a=!1,this.disconnecting=!0,this.authenticated&&(a=p({xmlns:f.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(a)):(f.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect())},_changeConnectStatus:function(a,b){for(var c in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(c)){var d=
this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){f.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(k){f._handleError(k),f.error("User connection callback caused an exception: "+k)}},_doDisconnect:function(a){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout);null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null);f.info("_doDisconnect was called");
this._proto._doDisconnect();this.restored=this.disconnecting=this.authenticated=!1;this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._changeConnectStatus(f.Status.DISCONNECTED,a);this.connected=!1},_dataRecv:function(a,b){f.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==f.Connection.prototype.xmlInput&&(c.nodeName===this._proto.strip&&c.childNodes.length?this.xmlInput(c.childNodes[0]):
this.xmlInput(c));this.rawInput!==f.Connection.prototype.rawInput&&(b?this.rawInput(b):this.rawInput(f.serialize(c)));for(var d;0<this.removeHandlers.length;)d=this.removeHandlers.pop(),d=this.handlers.indexOf(d),0<=d&&this.handlers.splice(d,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else if(d=c.getAttribute("type"),null!==d&&"terminate"==d)this.disconnecting||(d=c.getAttribute("condition"),c=
c.getElementsByTagName("conflict"),null!==d?("remote-stream-error"==d&&0<c.length&&(d="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,d)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),this._doDisconnect(d));else{var e=this;f.forEachChild(c,null,function(a){var b,c;c=e.handlers;e.handlers=[];for(b=0;b<c.length;b++){var d=c[b];try{d.isMatch(a)&&(e.authenticated||!d.user)?d.run(a)&&e.handlers.push(d):e.handlers.push(d)}catch(g){f.warn("Removing Strophe handlers due to uncaught exception: "+
g.message)}}})}}},mechanisms:{},_connect_cb:function(a,b,c){f.info("_connect_cb was called");this.connected=!0;var d;try{d=this._proto._reqToData(a)}catch(e){if("badformat"!=e)throw e;this._changeConnectStatus(f.Status.CONNFAIL,"bad-format");this._doDisconnect("bad-format")}if(d&&(this.xmlInput!==f.Connection.prototype.xmlInput&&(d.nodeName===this._proto.strip&&d.childNodes.length?this.xmlInput(d.childNodes[0]):this.xmlInput(d)),this.rawInput!==f.Connection.prototype.rawInput&&(c?this.rawInput(c):
this.rawInput(f.serialize(d))),this._proto._connect_cb(d)!==f.Status.CONNFAIL))if(d.getElementsByTagNameNS?0<d.getElementsByTagNameNS(f.NS.STREAM,"features").length:0<d.getElementsByTagName("stream:features").length||0<d.getElementsByTagName("features").length){var a=[],k,q=d.getElementsByTagName("mechanism");if(0<q.length)for(c=0;c<q.length;c++)k=f.getText(q[c]),this.mechanisms[k]&&a.push(this.mechanisms[k]);0===a.length&&0===d.getElementsByTagName("auth").length?this._proto._no_auth_received(b):
!1!==this.do_authentication&&this.authenticate(a)}else this._proto._no_auth_received(b)},sortMechanismsByPriority:function(a){var b,c,d;for(b=0;b<a.length-1;++b){d=b;for(c=b+1;c<a.length;++c)a[c].prototype.priority>a[d].prototype.priority&&(d=c);d!=b&&(c=a[b],a[b]=a[d],a[d]=c)}return a},_attemptSASLAuth:function(a){for(var a=this.sortMechanismsByPriority(a||[]),c=0,d=!1,c=0;c<a.length;++c)if(a[c].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),
null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null);this._sasl_mechanism=new a[c];this._sasl_mechanism.onStart(this);a=e("auth",{xmlns:f.NS.SASL,mechanism:this._sasl_mechanism.name});this._sasl_mechanism.isClientFirst&&(c=this._sasl_mechanism.onChallenge(this,null),a.t(b.encode(c)));this.send(a.tree());d=!0;
break}return d},_attemptLegacyAuth:function(){null===f.getNodeFromJid(this.jid)?(this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(l({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree()))},authenticate:function(a){this._attemptSASLAuth(a)||
this._attemptLegacyAuth()},_sasl_challenge_cb:function(a){var a=b.decode(f.getText(a)),a=this._sasl_mechanism.onChallenge(this,a),c=e("response",{xmlns:f.NS.SASL});""!==a&&c.t(b.encode(a));this.send(c.tree());return!0},_auth1_cb:function(){var a=l({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe");a.up().c("resource",{}).t(f.getResourceFromJid(this.jid));
this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(a.tree());return!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var c,a=b.decode(f.getText(a)).match(/([a-z]+)=([^,]+)(,|$)/);"v"==a[1]&&(c=a[2]);if(c!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data=
{},this._sasl_failure_cb(null)}f.info("SASL authentication succeeded.");if(this._sasl_mechanism)this._sasl_mechanism.onSuccess();this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var d=[],e=function(a,b){for(;a.length;)this.deleteHandler(a.pop());this._sasl_auth1_cb.bind(this)(b);return!1};d.push(this._addSysHandler(function(a){e.bind(this)(d,a)}.bind(this),
null,"stream:features",null,null));d.push(this._addSysHandler(function(a){e.bind(this)(d,a)}.bind(this),f.NS.STREAM,"features",null,null));this._sendRestart();return!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);this.do_bind?(this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2"),(a=f.getResourceFromJid(this.jid))?this.send(l({type:"set",
id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(a).tree()):this.send(l({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree())):this._changeConnectStatus(f.Status.AUTHFAIL,null);return!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){f.info("SASL binding failed.");var b;0<a.getElementsByTagName("conflict").length&&(b="conflict");this._changeConnectStatus(f.Status.AUTHFAIL,b);return!1}a=a.getElementsByTagName("bind");if(0<a.length)a=a[0].getElementsByTagName("jid"),
0<a.length&&(this.jid=f.getText(a[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(l({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)));else return f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_sasl_session_cb:function(a){"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,
null)):"error"==a.getAttribute("type")&&(f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null));return!1},_sasl_failure_cb:function(){this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null);this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);if(this._sasl_mechanism)this._sasl_mechanism.onFailure();this._changeConnectStatus(f.Status.AUTHFAIL,null);return!1},
_auth2_cb:function(a){"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect("authentication failed"));return!1},_addSysTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);c.user=!1;this.addTimeds.push(c);return c},_addSysHandler:function(a,b,c,d,e){a=new f.Handler(a,b,c,d,e);a.user=!1;this.addHandlers.push(a);return a},_onDisconnectTimeout:function(){f.info("_onDisconnectTimeout was called");
this._changeConnectStatus(f.Status.CONNTIMEOUT,null);this._proto._onDisconnectTimeout();this._doDisconnect();return!1},_onIdle:function(){for(var a,b,c,d;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),0<=a&&this.timedHandlers.splice(a,1);var f=(new Date).getTime();d=[];for(a=0;a<this.timedHandlers.length;a++)if(b=this.timedHandlers[a],this.authenticated||!b.user)c=b.lastCalled+b.period,
0>=c-f?b.run()&&d.push(b):d.push(b);this.timedHandlers=d;clearTimeout(this._idleTimeout);this._proto._onIdle();this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}};f.SASLMechanism=function(a,b,c){this.name=a;this.isClientFirst=b;this.priority=c};f.SASLMechanism.prototype={test:function(){return!0},onStart:function(a){this._connection=a},onChallenge:function(){throw Error("You should implement challenge handling!");},onFailure:function(){this._connection=null},
onSuccess:function(){this._connection=null}};f.SASLAnonymous=function(){};f.SASLAnonymous.prototype=new f.SASLMechanism("ANONYMOUS",!1,20);f.SASLAnonymous.prototype.test=function(a){return null===a.authcid};f.SASLPlain=function(){};f.SASLPlain.prototype=new f.SASLMechanism("PLAIN",!0,30);f.SASLPlain.prototype.test=function(a){return null!==a.authcid};f.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid,b=b+"\x00"+a.authcid,b=b+"\x00",b=b+a.pass;return d.utf16to8(b)};f.SASLSHA1=function(){};
f.SASLSHA1.prototype=new f.SASLMechanism("SCRAM-SHA-1",!0,50);f.SASLSHA1.prototype.test=function(a){return null!==a.authcid};f.SASLSHA1.prototype.onChallenge=function(f,e,i){e=i||c.hexdigest(1234567890*Math.random());i="n="+d.utf16to8(f.authcid);i=i+",r="+e;f._sasl_data.cnonce=e;f._sasl_data["client-first-message-bare"]=i;i="n,,"+i;this.onChallenge=function(c,f){var e,q,g,h,i,r,l="c=biws,",p=c._sasl_data["client-first-message-bare"]+","+f+",";r=c._sasl_data.cnonce;for(i=/([a-z]+)=([^,]+)(,|$)/;f.match(i);)switch(h=
f.match(i),f=f.replace(h[0],""),h[1]){case "r":e=h[2];break;case "s":q=h[2];break;case "i":g=h[2]}if(e.substr(0,r.length)!==r)return c._sasl_data={},c._sasl_failure_cb();l+="r="+e;p+=l;q=b.decode(q);q+="\x00\x00\x00\u0001";r=d.utf16to8(c.pass);q=e=a.core_hmac_sha1(r,q);for(i=1;i<g;i++){h=a.core_hmac_sha1(r,a.binb2str(e));for(e=0;5>e;e++)q[e]^=h[e];e=h}q=a.binb2str(q);g=a.core_hmac_sha1(q,"Client Key");e=a.str_hmac_sha1(q,"Server Key");q=a.core_hmac_sha1(a.str_sha1(a.binb2str(g)),p);c._sasl_data["server-signature"]=
a.b64_hmac_sha1(e,p);for(e=0;5>e;e++)g[e]^=q[e];return l+=",p="+b.encode(a.binb2str(g))}.bind(this);return i};f.SASLMD5=function(){};f.SASLMD5.prototype=new f.SASLMechanism("DIGEST-MD5",!1,40);f.SASLMD5.prototype.test=function(a){return null!==a.authcid};f.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'};f.SASLMD5.prototype.onChallenge=function(a,b,e){for(var f=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,e=e||c.hexdigest(""+1234567890*Math.random()),t="",r=null,
l="",p;b.match(f);)switch(p=b.match(f),b=b.replace(p[0],""),p[2]=p[2].replace(/^"(.+)"$/,"$1"),p[1]){case "realm":t=p[2];break;case "nonce":l=p[2];break;case "host":r=p[2]}b=a.servtype+"/"+a.domain;null!==r&&(b=b+"/"+r);f=d.utf16to8(a.authcid+":"+t+":"+this._connection.pass);f=c.hash(f)+":"+l+":"+e;r="AUTHENTICATE:"+b;a="charset=utf-8,"+("username="+this._quote(d.utf16to8(a.authcid))+",");a+="realm="+this._quote(t)+",";a+="nonce="+this._quote(l)+",";a+="nc=00000001,";a+="cnonce="+this._quote(e)+",";
a+="digest-uri="+this._quote(b)+",";a+="response="+c.hexdigest(c.hexdigest(f)+":"+l+":00000001:"+e+":auth:"+c.hexdigest(r))+",";a+="qop=auth";this.onChallenge=function(){return""};return a};f.SASLOAuthBearer=function(){};f.SASLOAuthBearer.prototype=new f.SASLMechanism("OAUTHBEARER",!0,60);f.SASLOAuthBearer.prototype.test=function(a){return null!==a.authcid};f.SASLOAuthBearer.prototype.onChallenge=function(a){var b;b="n,a="+a.authzid;b+=",\u0001";b+="auth=Bearer ";b+=a.pass;b+="\u0001";b+="\u0001";
return d.utf16to8(b)};f.SASLExternal=function(){};f.SASLExternal.prototype=new f.SASLMechanism("EXTERNAL",!0,10);f.SASLExternal.prototype.onChallenge=function(a){return a.authcid===a.authzid?"":a.authzid};return{Strophe:f,$build:e,$msg:function(a){return new f.Builder("message",a)},$iq:l,$pres:p,SHA1:a,Base64:b,MD5:c}};if("function"===typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return s.apply(this,arguments)});
else{var p=s(this.SHA1,this.Base64,this.MD5,this.stropheUtils);window.Strophe=p.Strophe;window.$build=p.$build;window.$iq=p.$iq;window.$msg=p.$msg;window.$pres=p.$pres;window.SHA1=p.SHA1;window.Base64=p.Base64;window.MD5=p.MD5;window.b64_hmac_sha1=p.SHA1.b64_hmac_sha1;window.b64_sha1=p.SHA1.b64_sha1;window.str_hmac_sha1=p.SHA1.str_hmac_sha1;window.str_sha1=p.SHA1.str_sha1}var u=function(a,b){a.Request=function(b,c,d,e){this.id=++a._requestId;this.xmlData=b;this.data=a.serialize(b);this.func=this.origFunc=
c;this.rid=d;this.date=NaN;this.sends=e||0;this.abort=!1;this.dead=null;this.age=function(){return!this.date?0:(new Date-this.date)/1E3};this.timeDead=function(){return!this.dead?0:(new Date-this.dead)/1E3};this.xhr=this._newXHR()};a.Request.prototype={getResponse:function(){var b=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(b=this.xhr.responseXML.documentElement,"parsererror"==b.tagName)throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),
a.error("responseXML: "+a.serialize(this.xhr.responseXML)),"parsererror";}else if(this.xhr.responseText)throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),"badformat";return b},_newXHR:function(){var a=null;window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP"));a.onreadystatechange=this.func.bind(null,this);return a}};a.Bosh=function(a){this._conn=
a;this.rid=Math.floor(4294967295*Math.random());this.sid=null;this.hold=1;this.wait=60;this.window=5;this.errors=0;this.inactivity=null;this._requests=[]};a.Bosh.prototype={strip:null,_buildBody:function(){var c=b("body",{rid:this.rid++,xmlns:a.NS.HTTPBIND});null!==this.sid&&c.attrs({sid:this.sid});this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession();return c},_reset:function(){this.rid=Math.floor(4294967295*Math.random());this.sid=null;this.errors=0;this._conn._sessionCachingSupported()&&
window.sessionStorage.removeItem("strophe-bosh-session");this._conn.nextValidRid(this.rid)},_connect:function(b,c,d){this.wait=b||this.wait;this.hold=c||this.hold;this.errors=0;b=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":a.NS.BOSH});d&&b.attrs({route:d});d=this._conn._connect_cb;this._requests.push(new a.Request(b.tree(),this._onRequestStateChange.bind(this,d.bind(this._conn)),
b.tree().getAttribute("rid")));this._throttledRequestHandler()},_attach:function(b,c,d,e,l,f,g){this._conn.jid=b;this.sid=c;this.rid=d;this._conn.connect_callback=e;this._conn.domain=a.getDomainFromJid(this._conn.jid);this._conn.authenticated=!0;this._conn.connected=!0;this.wait=l||this.wait;this.hold=f||this.hold;this.window=g||this.window;this._conn._changeConnectStatus(a.Status.ATTACHED,null)},_restore:function(b,c,d,e,l){var f=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));
if("undefined"!==typeof f&&null!==f&&f.rid&&f.sid&&f.jid&&("undefined"===typeof b||null===b||a.getBareJidFromJid(f.jid)==a.getBareJidFromJid(b)||null===a.getNodeFromJid(b)&&a.getDomainFromJid(f.jid)==b))this._conn.restored=!0,this._attach(f.jid,f.sid,f.rid,c,d,e,l);else throw{name:"StropheSessionError",message:"_restore: no restoreable session."};},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&(this.rid&&this.sid)&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,
rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(b){var c=b.getAttribute("type");if(null!==c&&"terminate"==c)return c=b.getAttribute("condition"),a.error("BOSH-Connection failed: "+c),b=b.getElementsByTagName("conflict"),null!==c?("remote-stream-error"==c&&0<b.length&&(c="conflict"),this._conn._changeConnectStatus(a.Status.CONNFAIL,c)):this._conn._changeConnectStatus(a.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(c),a.Status.CONNFAIL;
this.sid||(this.sid=b.getAttribute("sid"));if(c=b.getAttribute("requests"))this.window=parseInt(c,10);if(c=b.getAttribute("hold"))this.hold=parseInt(c,10);if(c=b.getAttribute("wait"))this.wait=parseInt(c,10);if(b=b.getAttribute("inactivity"))this.inactivity=parseInt(b,10)},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null;this.rid=Math.floor(4294967295*Math.random());this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session");
this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(a){var a=this._getRequestStatus(a),b;(b=this._conn.protocolErrorHandlers.HTTP[a])&&b.call(this,a)},_hitError:function(b){this.errors++;a.warn("request errored, status: "+b+", number of errors: "+this.errors);4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(b){var b=b?b.bind(this._conn):this._conn._connect_cb.bind(this._conn),c=this._buildBody();
this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,b.bind(this._conn)),c.tree().getAttribute("rid")));this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var a;0<this._requests.length;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}},_onIdle:function(){var b=this._conn._data;this._conn.authenticated&&(0===this._requests.length&&0===b.length&&!this._conn.disconnecting)&&
(a.info("no requests during idle cycle, sending blank request"),b.push(null));if(!this._conn.paused){if(2>this._requests.length&&0<b.length){for(var c=this._buildBody(),d=0;d<b.length;d++)null!==b[d]&&("restart"===b[d]?c.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":a.NS.BOSH}):c.cnode(b[d]).up());delete this._conn._data;this._conn._data=[];this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid")));
this._throttledRequestHandler()}0<this._requests.length&&(b=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),b>Math.floor(a.TIMEOUT*this.wait)&&(a.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(a.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler()))}},_getRequestStatus:function(b,c){var d;if(4==b.xhr.readyState)try{d=b.xhr.status}catch(e){a.error("Caught an error while retrieving a request's status, reqStatus: "+
d)}"undefined"==typeof d&&(d="number"===typeof c?c:0);return d},_onRequestStateChange:function(b,c){a.debug("request id "+c.id+"."+c.sends+" state changed to "+c.xhr.readyState);if(c.abort)c.abort=!1;else if(4===c.xhr.readyState){var d=this._getRequestStatus(c);if(this.disconnecting&&400<=d)this._hitError(d),this._callProtocolErrorHandlers(c);else{if(0<d&&500>d||5<c.sends)this._removeRequest(c),a.debug("request id "+c.id+" should now be removed");if(200==d){var e=this._requests[0]==c;(this._requests[1]==
c||e&&0<this._requests.length&&this._requests[0].age()>Math.floor(a.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0);this._conn.nextValidRid(Number(c.rid)+1);a.debug("request id "+c.id+"."+c.sends+" got 200");b(c);this.errors=0}else 0===d||400<=d&&600>d||12E3<=d?(a.error("request id "+c.id+"."+c.sends+" error "+d+" happened"),this._hitError(d),this._callProtocolErrorHandlers(c),400<=d&&500>d&&(this._conn._changeConnectStatus(a.Status.DISCONNECTING,null),this._conn._doDisconnect())):a.error("request id "+
c.id+"."+c.sends+" error "+d+" happened");(!(0<d&&500>d)||5<c.sends)&&this._throttledRequestHandler()}}},_processRequest:function(b){var c=this,d=this._requests[b],e=this._getRequestStatus(d,-1);if(d.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var l=d.age(),l=!isNaN(l)&&l>Math.floor(a.TIMEOUT*this.wait),f=null!==d.dead&&d.timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait),e=4==d.xhr.readyState&&(1>e||500<=e);if(l||f||e)f&&a.error("Request "+this._requests[b].id+" timed out (secondary), restarting"),
d.abort=!0,d.xhr.abort(),d.xhr.onreadystatechange=function(){},this._requests[b]=new a.Request(d.xmlData,d.origFunc,d.rid,d.sends),d=this._requests[b];if(0===d.xhr.readyState){a.debug("request id "+d.id+"."+d.sends+" posting");try{var g=this._conn.options.contentType||"text/xml; charset=utf-8";d.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0);"undefined"!==typeof d.xhr.setRequestHeader&&d.xhr.setRequestHeader("Content-Type",g);this._conn.options.withCredentials&&(d.xhr.withCredentials=
!0)}catch(h){a.error("XHR open failed.");this._conn.connected||this._conn._changeConnectStatus(a.Status.CONNFAIL,"bad-service");this._conn.disconnect();return}var i=function(){d.date=new Date;if(c._conn.options.customHeaders){var a=c._conn.options.customHeaders,b;for(b in a)a.hasOwnProperty(b)&&d.xhr.setRequestHeader(b,a[b])}d.xhr.send(d.data)};1<d.sends?(b=1E3*Math.min(Math.floor(a.TIMEOUT*this.wait),Math.pow(d.sends,3)),setTimeout(function(){i()},b)):i();d.sends++;this._conn.xmlOutput!==a.Connection.prototype.xmlOutput&&
(d.xmlData.nodeName===this.strip&&d.xmlData.childNodes.length?this._conn.xmlOutput(d.xmlData.childNodes[0]):this._conn.xmlOutput(d.xmlData));this._conn.rawOutput!==a.Connection.prototype.rawOutput&&this._conn.rawOutput(d.data)}else a.debug("_processRequest: "+(0===b?"first":"second")+" request has readyState of "+d.xhr.readyState)}},_removeRequest:function(b){a.debug("removing request");var c;for(c=this._requests.length-1;0<=c;c--)b==this._requests[c]&&this._requests.splice(c,1);b.xhr.onreadystatechange=
function(){};this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date);this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b)throw b;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(b){a.info("_sendTerminate was called");var c=this._buildBody().attrs({type:"terminate"});b&&c.cnode(b.tree());b=new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),
c.tree().getAttribute("rid"));this._requests.push(b);this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout);this._throttledRequestHandler();this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler();clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?a.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):a.debug("_throttledRequestHandler called with undefined requests");
this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};return a};"function"===typeof define&&define.amd?define("strophe-bosh",["strophe-core"],function(a){return u(a.Strophe,a.$build)}):u(Strophe,$build);var w=function(a,b){a.Websocket=function(a){this._conn=a;this.strip="wrapper";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c=
"",c="ws"===a.options.protocol&&"https:"!==window.location.protocol?c+"ws":c+"wss",c=c+("://"+window.location.host),c=0!==b.indexOf("/")?c+(window.location.pathname+b):c+b;a.service=c}};a.Websocket.prototype={_buildStream:function(){return b("open",{xmlns:a.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(b,c){var d;d=b.getElementsByTagNameNS?b.getElementsByTagNameNS(a.NS.STREAM,"error"):b.getElementsByTagName("stream:error");if(0===d.length)return!1;for(var e=d[0],l=d=
"",f=0;f<e.childNodes.length;f++){var g=e.childNodes[f];if("urn:ietf:params:xml:ns:xmpp-streams"!==g.getAttribute("xmlns"))break;"text"===g.nodeName?l=g.textContent:d=g.nodeName}e="WebSocket stream error: ";e=d?e+d:e+"unknown";l&&(e+=" - "+d);a.error(e);this._conn._changeConnectStatus(c,d);this._conn._doDisconnect();return!0},_reset:function(){},_connect:function(){this._closeSocket();this.socket=new WebSocket(this._conn.service,"xmpp");this.socket.onopen=this._onOpen.bind(this);this.socket.onerror=
this._onError.bind(this);this.socket.onclose=this._onClose.bind(this);this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(b){if(this._check_streamerror(b,a.Status.CONNFAIL))return a.Status.CONNFAIL},_handleStreamStart:function(b){var c=!1,d=b.getAttribute("xmlns");"string"!==typeof d?c="Missing xmlns in <open />":d!==a.NS.FRAMING&&(c="Wrong xmlns in <open />: "+d);b=b.getAttribute("version");"string"!==typeof b?c="Missing version in <open />":"1.0"!==b&&(c="Wrong version in <open />: "+
b);return c?(this._conn._changeConnectStatus(a.Status.CONNFAIL,c),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(b){if(0===b.data.indexOf("<open ")||0===b.data.indexOf("<?xml")){var c=b.data.replace(/^(<\?.*?\?>\s*)*/,"");""!==c&&(c=(new DOMParser).parseFromString(c,"text/xml").documentElement,this._conn.xmlInput(c),this._conn.rawInput(b.data),this._handleStreamStart(c)&&this._connect_cb(c))}else 0===b.data.indexOf("<close ")?(this._conn.rawInput(b.data),this._conn.xmlInput(b),(b=
b.getAttribute("see-other-uri"))?(this._conn._changeConnectStatus(a.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=b,this._connect()):(this._conn._changeConnectStatus(a.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())):(c=this._streamWrap(b.data),c=(new DOMParser).parseFromString(c,"text/xml").documentElement,this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,b.data))},_disconnect:function(c){if(this.socket&&
this.socket.readyState!==WebSocket.CLOSED){c&&this._conn.send(c);c=b("close",{xmlns:a.NS.FRAMING});this._conn.xmlOutput(c);c=a.serialize(c);this._conn.rawOutput(c);try{this.socket.send(c)}catch(d){a.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){a.info("WebSockets _doDisconnect was called");this._closeSocket()},_streamWrap:function(a){return"<wrapper>"+a+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(a){}this.socket=null},
_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(a.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):a.info("Websocket closed")},_no_auth_received:function(b){a.error("Server did not send any auth methods");this._conn._changeConnectStatus(a.Status.CONNFAIL,"Server did not send any auth methods");b&&(b=b.bind(this._conn),b());this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(b){a.error("Websocket error "+
b);this._conn._changeConnectStatus(a.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected.");this._disconnect()},_onIdle:function(){var b=this._conn._data;if(0<b.length&&!this._conn.paused){for(var c=0;c<b.length;c++)if(null!==b[c]){var d,e;d="restart"===b[c]?this._buildStream().tree():b[c];e=a.serialize(d);this._conn.xmlOutput(d);this._conn.rawOutput(e);this.socket.send(e)}this._conn._data=[]}},_onMessage:function(b){var c;if('<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />'===
b.data)this._conn.rawInput('<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />'),this._conn.xmlInput(b),this._conn.disconnecting||this._conn._doDisconnect();else{if(0===b.data.search("<open ")){if(c=(new DOMParser).parseFromString(b.data,"text/xml").documentElement,!this._handleStreamStart(c))return}else c=this._streamWrap(b.data),c=(new DOMParser).parseFromString(c,"text/xml").documentElement;this._check_streamerror(c,a.Status.ERROR)||(this._conn.disconnecting&&"presence"===c.firstChild.nodeName&&
"unavailable"===c.firstChild.getAttribute("type")?(this._conn.xmlInput(c),this._conn.rawInput(a.serialize(c))):this._conn._dataRecv(c,b.data))}},_onOpen:function(){a.info("Websocket open");var b=this._buildStream();this._conn.xmlOutput(b.tree());b=a.serialize(b);this._conn.rawOutput(b);this.socket.send(b)},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout);this._conn._onIdle.bind(this._conn)()}};return a};"function"===
typeof define&&define.amd?define("strophe-websocket",["strophe-core"],function(a){return w(a.Strophe,a.$build)}):w(Strophe,$build);"function"===typeof define&&define.amd&&define("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(a){return a});if(b)if("function"===typeof define&&define.amd)"function"===typeof requirejs?requirejs(["strophe"],function(a){b(a.Strophe,a.$build,a.$msg,a.$iq,a.$pres)}):require(["strophe"],function(a){b(a.Strophe,a.$build,a.$msg,a.$iq,a.$pres)});else return b(Strophe,
$build,$msg,$iq,$pres)})(function(b,a,c,d,e){window.Strophe=b;window.$build=a;window.$msg=c;window.$iq=d;window.$pres=e});
Strophe.addConnectionPlugin("streamManagement",{logging:!0,returnWholeStanza:!1,autoSendCountOnEveryIncomingStanza:!1,requestResponseInterval:5,_c:null,_NS:"urn:xmpp:sm:3",_isStreamManagementEnabled:!1,_serverProcesssedStanzasCounter:null,_clientProcessedStanzasCounter:null,_clientSentStanzasCounter:null,_originalXMLOutput:null,_requestHandler:null,_incomingHandler:null,_requestResponseIntervalCount:0,_unacknowledgedStanzas:[],_acknowledgedStanzaListeners:[],addAcknowledgedStanzaListener:function(b){this._acknowledgedStanzaListeners.push(b)},
enable:function(){this._c.send($build("enable",{xmlns:this._NS,resume:!1}));this._c.flush();this._c.pause()},requestAcknowledgement:function(){this._requestResponseIntervalCount=0;this._c.sendRequestAcknowledgement($build("r",{xmlns:this._NS}))},getOutgoingCounter:function(){return this._clientSentStanzasCounter},getIncomingCounter:function(){return this._clientProcessedStanzasCounter},init:function(b){this._c=b;Strophe.addNamespace("SM",this._NS);this._originalXMLOutput=this._c.xmlOutput;this._c.xmlOutput=
this.xmlOutput.bind(this)},statusChanged:function(b){if(b===Strophe.Status.CONNECTED||b===Strophe.Status.DISCONNECTED)this._clientSentStanzasCounter=this._clientProcessedStanzasCounter=this._serverProcesssedStanzasCounter=0,this._isStreamManagementEnabled=!1,this._requestResponseIntervalCount=0,this._unacknowledgedStanzas=[],this._requestHandler&&this._c.deleteHandler(this._requestHandler),this._incomingHandler&&this._c.deleteHandler(this._incomingHandler),this._requestHandler=this._c.addHandler(this._handleServerRequestHandler.bind(this),
this._NS,"r"),this._incomingHandler=this._c.addHandler(this._incomingStanzaHandler.bind(this))},xmlOutput:function(b){if(this._c.useWebSocket)this._increaseSentStanzasCounter(b);else if(b.children)for(var a,c=0;c<b.children.length;c++)a=b.children[c],this._increaseSentStanzasCounter(a);return this._originalXMLOutput.call(this._c,b)},_incomingStanzaHandler:function(b){Strophe.isTagEqual(b,"enabled")&&b.getAttribute("xmlns")===this._NS&&(this._isStreamManagementEnabled=!0,this._c.resume());if(Strophe.isTagEqual(b,
"iq")||Strophe.isTagEqual(b,"presence")||Strophe.isTagEqual(b,"message"))this._increaseReceivedStanzasCounter(),this.autoSendCountOnEveryIncomingStanza&&this._answerProcessedStanzas();Strophe.isTagEqual(b,"a")&&(b=parseInt(b.getAttribute("h")),this._handleAcknowledgedStanzas(b,this._serverProcesssedStanzasCounter),this._serverProcesssedStanzasCounter=b,0<this.requestResponseInterval&&(this._requestResponseIntervalCount=0));return!0},_handleAcknowledgedStanzas:function(b,a){var c=b-a;0>c&&this._throwError("New reported stanza count lower than previous. New: "+
b+" - Previous: "+a);c>this._unacknowledgedStanzas.length&&this._throwError("Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: "+c+" - Unacknowledge Stanza Count: "+this._unacknowledgedStanzas.length+" - New: "+b+" - Previous: "+a);for(var d=0;d<c;d++)for(var e=this._unacknowledgedStanzas.shift(),l=0;l<this._acknowledgedStanzaListeners.length;l++)this._acknowledgedStanzaListeners[l](e);this.logging&&(0<this._unacknowledgedStanzas.length?console.warn("Unacknowledged stanzas",
this._unacknowledgedStanzas):console.warn("All Stanza is Acknowledge!"))},_handleServerRequestHandler:function(){this._answerProcessedStanzas();return!0},_answerProcessedStanzas:function(){this._isStreamManagementEnabled&&this._c.send($build("a",{xmlns:this._NS,h:this._clientProcessedStanzasCounter}))},_increaseSentStanzasCounter:function(b){this._isStreamManagementEnabled&&this._judgeIsNeedRecordStanza(b)&&(this._unacknowledgedStanzas.push(this.returnWholeStanza?b:b.nodeName),this._clientSentStanzasCounter++,
0<this.requestResponseInterval&&(this._requestResponseIntervalCount++,this._requestResponseIntervalCount===this.requestResponseInterval&&this.requestAcknowledgement()))},_judgeIsNeedRecordStanza:function(b){return Strophe.isTagEqual(b,"iq")||Strophe.isTagEqual(b,"presence")||Strophe.isTagEqual(b,"message")},_increaseReceivedStanzasCounter:function(){this._isStreamManagementEnabled&&this._clientProcessedStanzasCounter++},_throwError:function(b){console.error(b);throw Error(b);}});
var Occupant,RoomConfig,XmppRoom,__bind=function(b,a){return function(){return b.apply(a,arguments)}};
Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(b){this._connection=b;this._muc_handler=null;Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner");Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin");Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user");return Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig")},join:function(b,a,c,d,e,l,s){var p,u=this;p=this.test_append_nick(b,a);p=$pres({from:this._connection.jid,to:p}).c("x",{xmlns:Strophe.NS.MUC});
null!=s&&(p=p.c("history",s));null!=l&&p.cnode(Strophe.xmlElement("password",[],l));null==this._muc_handler&&(this._muc_handler=this._connection.addHandler(function(a){var c,d,e,k,l,p;c=a.getAttribute("from");if(!c)return!0;c=c.split("/")[0];if(!u.rooms[c])return!0;b=u.rooms[c];c={};if("message"===a.nodeName)c=b._message_handlers;else if("presence"===a.nodeName&&(d=a.getElementsByTagName("x"),0<d.length)){l=0;for(p=d.length;l<p;l++)if(k=d[l],(k=k.getAttribute("xmlns"))&&k.match(Strophe.NS.MUC)){c=
b._presence_handlers;break}}for(e in c)d=c[e],d(a,b)||delete c[e];return!0}));this.rooms.hasOwnProperty(b)||(this.rooms[b]=new XmppRoom(this,b,a,l),this.roomNames.push(b));d&&this.rooms[b].addHandler("presence",d);c&&this.rooms[b].addHandler("message",c);e&&this.rooms[b].addHandler("roster",e);return this._connection.send(p)},leave:function(b,a,c,d){var e;e=this.roomNames.indexOf(b);delete this.rooms[b];0<=e&&(this.roomNames.splice(e,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),
this._muc_handler=null));a=this.test_append_nick(b,a);b=this._connection.getUniqueId();a=$pres({type:"unavailable",id:b,from:this._connection.jid,to:a});null!=d&&a.c("status",d);null!=c&&this._connection.addHandler(c,null,"presence",null,b);this._connection.send(a);return b},message:function(b,a,c,d,e){b=this.test_append_nick(b,a);e=e||(null!=a?"chat":"groupchat");a=this._connection.getUniqueId();c=$msg({to:b,from:this._connection.jid,type:e,id:a}).c("body",{xmlns:Strophe.NS.CLIENT}).t(c);c.up();
null!=d&&(c.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).t(d),0===c.node.childNodes.length?(d=c.node.parentNode,c.up().up(),c.node.removeChild(d)):c.up().up());c.c("x",{xmlns:"jabber:x:event"}).c("composing");this._connection.send(c);return a},groupchat:function(b,a,c){return this.message(b,null,a,c)},invite:function(b,a,c){var d;d=this._connection.getUniqueId();b=$msg({from:this._connection.jid,to:b,id:d}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:a});null!=c&&
b.c("reason",c);this._connection.send(b);return d},directInvite:function(b,a,c,d){var e;e=this._connection.getUniqueId();b={xmlns:"jabber:x:conference",jid:b};null!=c&&(b.reason=c);null!=d&&(b.password=d);a=$msg({from:this._connection.jid,to:a,id:e}).c("x",b);this._connection.send(a);return e},queryOccupants:function(b,a,c){var d;d={xmlns:Strophe.NS.DISCO_ITEMS};b=$iq({from:this._connection.jid,to:b,type:"get"}).c("query",d);return this._connection.sendIQ(b,a,c)},configure:function(b,a,c){b=$iq({to:b,
type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).tree();return this._connection.sendIQ(b,a,c)},cancelConfigure:function(b){b=$iq({to:b,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}).tree();return this._connection.sendIQ(b)},saveConfiguration:function(b,a,c,d){var e,l,s;e=$iq({to:b,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER});if(a instanceof Form)a.type="submit",e.cnode(a.toXML());else{e.c("x",{xmlns:"jabber:x:data",type:"submit"});l=0;
for(s=a.length;l<s;l++)b=a[l],e.cnode(b).up()}a=e.tree();return this._connection.sendIQ(a,c,d)},createInstantRoom:function(b,a,c){b=$iq({to:b,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});return this._connection.sendIQ(b.tree(),a,c)},setTopic:function(b,a){var c;c=$msg({to:b,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(a);return this._connection.send(c.tree())},_modifyPrivilege:function(b,a,c,d,e){b=$iq({to:b,
type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(a.node);null!=c&&b.c("reason",c);return this._connection.sendIQ(b.tree(),d,e)},modifyRole:function(b,a,c,d,e,l){a=$build("item",{nick:a,role:c});return this._modifyPrivilege(b,a,d,e,l)},kick:function(b,a,c,d,e){return this.modifyRole(b,a,"none",c,d,e)},voice:function(b,a,c,d,e){return this.modifyRole(b,a,"participant",c,d,e)},mute:function(b,a,c,d,e){return this.modifyRole(b,a,"visitor",c,d,e)},op:function(b,a,c,d,e){return this.modifyRole(b,
a,"moderator",c,d,e)},deop:function(b,a,c,d,e){return this.modifyRole(b,a,"participant",c,d,e)},modifyAffiliation:function(b,a,c,d,e,l){a=$build("item",{jid:a,affiliation:c});return this._modifyPrivilege(b,a,d,e,l)},ban:function(b,a,c,d,e){return this.modifyAffiliation(b,a,"outcast",c,d,e)},member:function(b,a,c,d,e){return this.modifyAffiliation(b,a,"member",c,d,e)},revoke:function(b,a,c,d,e){return this.modifyAffiliation(b,a,"none",c,d,e)},owner:function(b,a,c,d,e){return this.modifyAffiliation(b,
a,"owner",c,d,e)},admin:function(b,a,c,d,e){return this.modifyAffiliation(b,a,"admin",c,d,e)},changeNick:function(b,a){var c;c=this.test_append_nick(b,a);c=$pres({from:this._connection.jid,to:c,id:this._connection.getUniqueId()});return this._connection.send(c.tree())},setStatus:function(b,a,c,d){b=this.test_append_nick(b,a);b=$pres({from:this._connection.jid,to:b});null!=c&&b.c("show",c).up();null!=d&&b.c("status",d);return this._connection.send(b.tree())},listRooms:function(b,a,c){b=$iq({to:b,from:this._connection.jid,
type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS});return this._connection.sendIQ(b,a,c)},test_append_nick:function(b,a){return b+(null!=a?"/"+Strophe.escapeNode(a):"")}});
XmppRoom=function(){function b(a,b,d,e){this.client=a;this.name=b;this.nick=d;this.password=e;this._roomRosterHandler=__bind(this._roomRosterHandler,this);this._addOccupant=__bind(this._addOccupant,this);this.roster={};this._message_handlers={};this._presence_handlers={};this._roster_handlers={};this._handler_ids=0;a.muc&&(this.client=a.muc);this.name=Strophe.getBareJidFromJid(b);this.addHandler("presence",this._roomRosterHandler)}b.prototype.join=function(a,b,d){return this.client.join(this.name,
this.nick,a,b,d,this.password)};b.prototype.leave=function(a,b){this.client.leave(this.name,this.nick,a,b);return delete this.client.rooms[this.name]};b.prototype.message=function(a,b,d,e){return this.client.message(this.name,a,b,d,e)};b.prototype.groupchat=function(a,b){return this.client.groupchat(this.name,a,b)};b.prototype.invite=function(a,b){return this.client.invite(this.name,a,b)};b.prototype.directInvite=function(a,b){return this.client.directInvite(this.name,a,b,this.password)};b.prototype.configure=
function(a){return this.client.configure(this.name,a)};b.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)};b.prototype.saveConfiguration=function(a){return this.client.saveConfiguration(this.name,a)};b.prototype.queryOccupants=function(a,b){return this.client.queryOccupants(this.name,a,b)};b.prototype.setTopic=function(a){return this.client.setTopic(this.name,a)};b.prototype.modifyRole=function(a,b,d,e,l){return this.client.modifyRole(this.name,a,b,d,e,l)};b.prototype.kick=
function(a,b,d,e){return this.client.kick(this.name,a,b,d,e)};b.prototype.voice=function(a,b,d,e){return this.client.voice(this.name,a,b,d,e)};b.prototype.mute=function(a,b,d,e){return this.client.mute(this.name,a,b,d,e)};b.prototype.op=function(a,b,d,e){return this.client.op(this.name,a,b,d,e)};b.prototype.deop=function(a,b,d,e){return this.client.deop(this.name,a,b,d,e)};b.prototype.modifyAffiliation=function(a,b,d,e,l){return this.client.modifyAffiliation(this.name,a,b,d,e,l)};b.prototype.ban=
function(a,b,d,e){return this.client.ban(this.name,a,b,d,e)};b.prototype.member=function(a,b,d,e){return this.client.member(this.name,a,b,d,e)};b.prototype.revoke=function(a,b,d,e){return this.client.revoke(this.name,a,b,d,e)};b.prototype.owner=function(a,b,d,e){return this.client.owner(this.name,a,b,d,e)};b.prototype.admin=function(a,b,d,e){return this.client.admin(this.name,a,b,d,e)};b.prototype.changeNick=function(a){this.nick=a;return this.client.changeNick(this.name,a)};b.prototype.setStatus=
function(a,b){return this.client.setStatus(this.name,this.nick,a,b)};b.prototype.addHandler=function(a,b){var d;d=this._handler_ids++;switch(a){case "presence":this._presence_handlers[d]=b;break;case "message":this._message_handlers[d]=b;break;case "roster":this._roster_handlers[d]=b;break;default:return this._handler_ids--,null}return d};b.prototype.removeHandler=function(a){delete this._presence_handlers[a];delete this._message_handlers[a];return delete this._roster_handlers[a]};b.prototype._addOccupant=
function(a){a=new Occupant(a,this);return this.roster[a.nick]=a};b.prototype._roomRosterHandler=function(a){var c,d,e,a=b._parsePresence(a);e=a.nick;d=a.newnick||null;switch(a.type){case "error":return;case "unavailable":d&&(a.nick=d,this.roster[e]&&this.roster[d]&&(this.roster[e].update(this.roster[d]),this.roster[d]=this.roster[e]),this.roster[e]&&!this.roster[d]&&(this.roster[d]=this.roster[e].update(a)));delete this.roster[e];break;default:this.roster[e]?this.roster[e].update(a):this._addOccupant(a)}d=
this._roster_handlers;for(c in d)a=d[c],a(this.roster,this)||delete this._roster_handlers[c];return!0};b._parsePresence=function(a){var b,d,e,l,s,p,u,w,t,v,q,k;e={};b=a.attributes;e.nick=Strophe.getResourceFromJid(b.from.textContent);e.type=(null!=(l=b.type)?l.textContent:void 0)||null;e.states=[];p=a.childNodes;a=0;for(l=p.length;a<l;a++)switch(d=p[a],d.nodeName){case "status":e.status=d.textContent||null;break;case "show":e.show=d.textContent||null;break;case "x":if(b=d.attributes,(null!=(u=b.xmlns)?
u.textContent:void 0)===Strophe.NS.MUC_USER){w=d.childNodes;d=0;for(s=w.length;d<s;d++)switch(b=w[d],b.nodeName){case "item":b=b.attributes;e.affiliation=(null!=(t=b.affiliation)?t.textContent:void 0)||null;e.role=(null!=(v=b.role)?v.textContent:void 0)||null;e.jid=(null!=(q=b.jid)?q.textContent:void 0)||null;e.newnick=(null!=(k=b.nick)?k.textContent:void 0)||null;break;case "status":b.attributes.code&&e.states.push(b.attributes.code.textContent)}}}return e};return b}();
RoomConfig=function(){function b(a){this.parse=__bind(this.parse,this);null!=a&&this.parse(a)}b.prototype.parse=function(a){var b,d,e,l,s,p,u;e=a.getElementsByTagName("query")[0].childNodes;this.identities=[];this.features=[];this.x=[];l=0;for(p=e.length;l<p;l++)switch(b=e[l],a=b.attributes,b.nodeName){case "identity":d={};s=0;for(u=a.length;s<u;s++)b=a[s],d[b.name]=b.textContent;this.identities.push(d);break;case "feature":this.features.push(a["var"].textContent);break;case "x":a=b.childNodes[0].attributes;
if("FORM_TYPE"===!a["var"].textContent||"hidden"===!a.type.textContent)break;u=b.childNodes;d=0;for(s=u.length;d<s;d++)b=u[d],b.attributes.type||(a=b.attributes,this.x.push({"var":a["var"].textContent,label:a.label.textContent||"",value:b.firstChild.textContent||""}))}return{identities:this.identities,features:this.features,x:this.x}};return b}();
Occupant=function(){function b(a,b){this.room=b;this.update=__bind(this.update,this);this.admin=__bind(this.admin,this);this.owner=__bind(this.owner,this);this.revoke=__bind(this.revoke,this);this.member=__bind(this.member,this);this.ban=__bind(this.ban,this);this.modifyAffiliation=__bind(this.modifyAffiliation,this);this.deop=__bind(this.deop,this);this.op=__bind(this.op,this);this.mute=__bind(this.mute,this);this.voice=__bind(this.voice,this);this.kick=__bind(this.kick,this);this.modifyRole=__bind(this.modifyRole,
this);this.update(a)}b.prototype.modifyRole=function(a,b,d,e){return this.room.modifyRole(this.nick,a,b,d,e)};b.prototype.kick=function(a,b,d){return this.room.kick(this.nick,a,b,d)};b.prototype.voice=function(a,b,d){return this.room.voice(this.nick,a,b,d)};b.prototype.mute=function(a,b,d){return this.room.mute(this.nick,a,b,d)};b.prototype.op=function(a,b,d){return this.room.op(this.nick,a,b,d)};b.prototype.deop=function(a,b,d){return this.room.deop(this.nick,a,b,d)};b.prototype.modifyAffiliation=
function(a,b,d,e){return this.room.modifyAffiliation(this.jid,a,b,d,e)};b.prototype.ban=function(a,b,d){return this.room.ban(this.jid,a,b,d)};b.prototype.member=function(a,b,d){return this.room.member(this.jid,a,b,d)};b.prototype.revoke=function(a,b,d){return this.room.revoke(this.jid,a,b,d)};b.prototype.owner=function(a,b,d){return this.room.owner(this.jid,a,b,d)};b.prototype.admin=function(a,b,d){return this.room.admin(this.jid,a,b,d)};b.prototype.update=function(a){this.nick=a.nick||null;this.affiliation=
a.affiliation||null;this.role=a.role||null;this.jid=a.jid||null;this.status=a.status||null;this.show=a.show||null;return this};return b}();
Strophe.addConnectionPlugin("receipts",{_conn:null,_timeoutHandler:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9E3,init:function(b){this._conn=b;Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(b){if(b===Strophe.Status.CONNECTED||b===Strophe.Status.ATTACHED){var a=this;setTimeout(function(){a.resendQueue()},5E3)}},sendMessage:function(b){var a=null;b.tree().hasAttribute("id")?a=b.tree().getAttribute("id"):(a=this._conn.getUniqueId(),b.tree().setAttribute("id",
a));var c=Strophe.xmlElement("request",{xmlns:Strophe.NS.RECEIPTS});b.tree().appendChild(c);this._msgQueue[a]=b;this._retries[a]=0;this._conn.send(b);this.resendMessage(a);this.timeout(a);return a},timeout:function(b){var a=this;setTimeout(function(){a._msgQueue[b]&&a._timeoutHandler&&a._timeoutHandler(a._msgQueue[b])},this._resendTime)},resendMessage:function(b){var a=this;setTimeout(function(){a._msgQueue[b]&&(a._conn.connected?(a._retries[b]++,a._retries[b]>a._resendCount||(a._msgQueue[b].tree().setAttribute("from",
a._conn.jid),a._conn.send(a._msgQueue[b]),a.resendMessage(b))):a.resendMessage(b))},this._resendTime)},addReceiptHandler:function(b,a,c,d){var e=this;this._conn.addHandler(function(a){if(a=e._processReceipt(a))try{b(a)}catch(c){console.error("custom receipt handler deal error!")}return!0},Strophe.NS.RECEIPTS,"message",a,null,c,d)},addTimeoutHandler:function(b){this._timeoutHandler=b},_processReceipt:function(b){var a=b.getAttribute("id"),c=b.getAttribute("from"),d=b.getElementsByTagName("request"),
e=b.getElementsByTagName("received");return"error"!=b.getAttribute("type")&&(0<d.length&&(b=$msg({to:c,from:this._conn.jid,id:this._conn.getUniqueId()}),a=Strophe.xmlElement("received",{xmlns:Strophe.NS.RECEIPTS,id:a}),b.tree().appendChild(a),this._conn.send(b)),0<e.length&&(e=e[0].getAttribute("id")))?(a=this._msgQueue[e],delete this._msgQueue[e],delete this._retries[e],a):null},resendQueue:function(){if(this._conn.connected)for(var b in this._msgQueue)this._msgQueue.hasOwnProperty(b)&&this._conn.send(this._msgQueue[b]);
else{var a=this;setTimeout(function(){a.resendQueue()},5E3)}},getUnreceivedMsgs:function(){var b=[],a;for(a in this._msgQueue)this._msgQueue.hasOwnProperty(a)&&b.push(this._msgQueue[a]);return b},clearMessages:function(){this._msgQueue={}}});
Strophe.addConnectionPlugin("roster",{_connection:null,_callbacks:[],items:[],ver:null,init:function(b){this._connection=b;this.items=[];var a,c=this,d=b.connect,e=b.attach,l=function(d){if(d==Strophe.Status.ATTACHED||d==Strophe.Status.CONNECTED)try{b.addHandler(c._onReceivePresence.bind(c),null,"presence",null,null,null),b.addHandler(c._onReceiveIQ.bind(c),Strophe.NS.ROSTER,"iq","set",null,null)}catch(e){Strophe.error(e)}null!==a&&a.apply(this,arguments)};b.connect=function(c,e,u,w,t){a=u;"undefined"==
typeof arguments[0]&&(arguments[0]=null);"undefined"==typeof arguments[1]&&(arguments[1]=null);arguments[2]=l;d.apply(b,arguments)};b.attach=function(c,d,u,w,t,v,q){a=w;"undefined"==typeof arguments[0]&&(arguments[0]=null);"undefined"==typeof arguments[1]&&(arguments[1]=null);"undefined"==typeof arguments[2]&&(arguments[2]=null);arguments[3]=l;e.apply(b,arguments)};Strophe.addNamespace("ROSTER_VER","urn:xmpp:features:rosterver")},supportVersioning:function(){return this._connection.features&&0<this._connection.features.getElementsByTagName("ver").length},
get:function(b,a,c){var d={xmlns:Strophe.NS.ROSTER};this.items=[];this.supportVersioning()&&(d.ver=a||"",this.items=c||[]);a=$iq({type:"get",id:this._connection.getUniqueId("roster")}).c("query",d);return this._connection.sendIQ(a,this._onReceiveRosterSuccess.bind(this,b),this._onReceiveRosterError.bind(this,b))},registerCallback:function(b){this._callbacks.push(b)},findItem:function(b){for(var a=0;a<this.items.length;a++)if(this.items[a]&&this.items[a].jid==b)return this.items[a];return!1},removeItem:function(b){for(var a=
0;a<this.items.length;a++)if(this.items[a]&&this.items[a].jid==b)return this.items.splice(a,1),!0;return!1},subscribe:function(b,a){var c=$pres({to:b,type:"subscribe"});a&&""!=a&&c.c("status").t(a);this._connection.send(c)},unsubscribe:function(b,a){var c=$pres({to:b,type:"unsubscribe"});a&&""!=a&&c.c("status").t(a);this._connection.send(c)},authorize:function(b,a){var c=$pres({to:b,type:"subscribed"});a&&""!=a&&c.c("status").t(a);this._connection.send(c)},unauthorize:function(b,a){var c=$pres({to:b,
type:"unsubscribed"});a&&""!=a&&c.c("status").t(a);this._connection.send(c)},add:function(b,a,c,d){b=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:b,name:a});for(a=0;a<c.length;a++)b.c("group").t(c[a]).up();this._connection.sendIQ(b,d,d)},update:function(b,a,c,d){b=this.findItem(b);if(!b)throw"item not found";a=a||b.name;c=c||b.groups;b=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:b.jid,name:a});for(a=0;a<c.length;a++)b.c("group").t(c[a]).up();return this._connection.sendIQ(b,
d,d)},remove:function(b,a){var c=this.findItem(b);if(!c)throw"item not found";c=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:c.jid,subscription:"remove"});this._connection.sendIQ(c,a,a)},_onReceiveRosterSuccess:function(b,a){this._updateItems(a);b(this.items)},_onReceiveRosterError:function(b){b(this.items)},_onReceivePresence:function(b){var a=b.getAttribute("from"),c=Strophe.getBareJidFromJid(a),c=this.findItem(c);if(!c)return!0;var d=b.getAttribute("type");if("unavailable"==
d)delete c.resources[Strophe.getResourceFromJid(a)];else{if(d)return!0;c.resources[Strophe.getResourceFromJid(a)]={show:0!=b.getElementsByTagName("show").length?Strophe.getText(b.getElementsByTagName("show")[0]):"",status:0!=b.getElementsByTagName("status").length?Strophe.getText(b.getElementsByTagName("status")[0]):"",priority:0!=b.getElementsByTagName("priority").length?Strophe.getText(b.getElementsByTagName("priority")[0]):""}}this._call_backs(this.items,c);return!0},_call_backs:function(b,a){for(var c=
0;c<this._callbacks.length;c++)this._callbacks[c](b,a)},_onReceiveIQ:function(b){var a=b.getAttribute("id"),c=b.getAttribute("from");if(c&&""!=c&&c!=this._connection.jid&&c!=Strophe.getBareJidFromJid(this._connection.jid))return!0;a=$iq({type:"result",id:a,from:this._connection.jid});this._connection.send(a);this._updateItems(b);return!0},_updateItems:function(b){b=b.getElementsByTagName("query");if(0!=b.length){this.ver=b.item(0).getAttribute("ver");var a=this;Strophe.forEachChild(b.item(0),"item",
function(b){a._updateItem(b)})}this._call_backs(this.items)},_updateItem:function(b){var a=b.getAttribute("jid"),c=b.getAttribute("name"),d=b.getAttribute("subscription"),e=b.getAttribute("ask"),l=[];Strophe.forEachChild(b,"group",function(a){l.push(Strophe.getText(a))});"remove"==d?this.removeItem(a):(b=this.findItem(a))?(b.name=c,b.subscription=d,b.ask=e,b.groups=l):this.items.push({name:c,jid:a,subscription:d,ask:e,groups:l,resources:{}})}});
Strophe.addConnectionPlugin("ping",{_c:null,init:function(b){this._c=b;Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(b,a,c,d){var e=this._c.getUniqueId("ping"),b=$iq({type:"get",to:b,id:e}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(b,a,c,d)},pong:function(b){var a=b.getAttribute("from"),b=b.getAttribute("id"),a=$iq({type:"result",to:a,id:b});this._c.sendIQ(a)},addPingHandler:function(b){return this._c.addHandler(b,Strophe.NS.PING,"iq","get")}});
"function"===typeof define&&define.tmpAmd&&(define.amd=define.tmpAmd);
